{% extends "base.html" %}
{% load view_extras %}
{% load static %}

{% block banner %}
<div class="text-start">
  <a class="navbar-brand fs-2" href="/group/{{ group.name }}">{{ group.display_name }}</a>
  <p>{{ group.desc }}</p>
</div>
{% endblock banner %}

{% block page_title %}
{% if current_page == "group_my_sharing" %}我的文献分享列表{% endif %}
{% if current_page == "group_all" %}文献分享列表{% endif %}
{% if current_page == "group_recent" %}近期文献分享列表{% endif %}
{% if current_page == "group_this_month" %}本月文献分享列表{% endif %}
{% if current_page == "group_last_month" %}上月文献分享列表{% endif %}
{% if current_page == "group_trash" %}文献分享列表（回收站）{% endif %}
{% if current_page == "group_journal" %}文献分享列表{% endif %}
{% if current_page == "group_user" %}文献分享列表{% endif %}
{% endblock page_title %}

{% block page_subtitle %}
{% if current_page == "group_journal" %}来自杂志 <a href="{% url 'group:journal' journal_name=journal_name|urlencode_full group_name=group.name %}"><i>{{ journal_name }}</i></a> 的文献。{% endif %}
{% if current_page == "group_user" %}来自用户 <a href="{% url "group:user" id=user_info.pk group_name=group.name %}">{{ user_info }}</a> 的文献。{% endif %}
{% endblock page_subtitle %}

{% block content %}
{% if user.is_authenticated %}
<section>
  <div class="container my-4">
    <div class="text-center">
      <a class="btn btn-warning btn-lg" href="javascript:add_review();">分享打卡</a>
    </div>
  </div>
</section>
{% endif %}

<section>
{% if reviews %}
  <div class="my-3">
    当前共有 {{ reviews.paginator.count }} 篇文献分享{% if reviews.paginator.num_pages > 1 %}，本页显示第 {{ reviews.start_index }} - {{ reviews.end_index }} 篇{% endif %}。
  </div>

  {% include "group/paginator.html" %}

  {% for review, index in items %}
  <div id="card_{{review.pk}}" class="card p-2 my-3 d-flex flex-row">
    <div class="p-2 text-start"><a href="{% url "group:review" id=review.pk group_name=group.name %}">{{ index }}</a>.</div>
    <div class="p-2 text-start flex-fill">
      {% include "group/review-info.html" %}
      <div class="my-3">{{ review.comments }}</div>
      {% with review.paper as paper %}
      <div id="card_{{paper.pk}}" class="card p-2">
        <div id="info_{{paper.pk}}" class="text-start">
          <div class="flex-fill">{% include "view/paper-info.html" %}</div>
        </div>
        <div class="my-2">
          <div id="title_{{paper.pk}}" class="d-inline text-start">
            <div id="title_{{paper.pk}}_text" class="d-inline fs-5 fw-bold"><a href="{% url 'paper' id=paper.pk %}">{{ paper.title }}</a></div>
            <a class="ms-2" href="javascript:translate_title({{ paper.pk }}, '{% url 'api:translate_title' %}', '{{csrf_token}}')">翻译</a>
          </div>
          <div id="title_cn_{{ paper.pk }}" class="mt-1 d-none">
          {% if paper.translation and paper.translation.title_cn %}
          {{ paper.translation.title_cn }}
          {% endif %}
          </div>
        </div>
        {% include "view/paper-author-list.html" %}
        {% include "view/paper-abstract.html" %}
        {% include "view/paper-keyword-list.html" %}
      </div>
      {% endwith %}
    </div>
    <div class="text-end my-3">
      {% include "group/review-info-js.html" %}
    </div>
  </div>
  {% endfor %}

  {% include "group/paginator.html" %}

  <script src="{% static 'js/paper.js' %}"></script>
  {% include "group/review-info-js.html" %}
{% else %}
  <p style="padding:20px; height:200px;">暂无任何内容。</p>
{% endif %}
</section>
{% endblock content %}
