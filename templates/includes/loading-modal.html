<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" role="dialog" aria-labelledby="loadingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body text-center">
        <div class="spinner-border text-primary mt-4" role="status">
        </div>
        <p id="loadingModalText" class="mt-2">请稍候……</p>
        <div class="mt-3 text-center">
          <button type="button" class="btn btn-danger" id="loadingModalCancel">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script>
function show_loading_modal(message, allowCancel=false, cancerButtonText='Cancel', cancelButtonCallback=null) {
  var loadingModal = document.getElementById('loadingModal');
  var loadingModalCancel = document.getElementById('loadingModalCancel');
  var loadingModalText = document.getElementById('loadingModalText');
  
  if (loadingModalCancel) {
    if (allowCancel) {
      loadingModalCancel.style.display = 'block';
      loadingModalCancel.textContent = cancerButtonText;
      // Remove existing click listeners and add new one
      loadingModalCancel.replaceWith(loadingModalCancel.cloneNode(true));
      loadingModalCancel = document.getElementById('loadingModalCancel');
      if (cancelButtonCallback) {
        loadingModalCancel.addEventListener('click', cancelButtonCallback);
      }
    } else {
      loadingModalCancel.style.display = 'none';
    }
  }
  
  if (loadingModalText) {
    if (message) {
      loadingModalText.textContent = message;
    } else {
      loadingModalText.textContent = '请稍候……';
    }
  }
  
  if (loadingModal) {
    var modal = new bootstrap.Modal(loadingModal);
    modal.show();
  }
}

function hide_loading_modal() {
  console.log('hide_loading_modal');
  var loadingModal = document.getElementById('loadingModal');
  if (loadingModal) {
    var modal = bootstrap.Modal.getInstance(loadingModal);
    if (modal) {
      modal.hide();
    }
  }
}
</script>