{% load view_extras %}
{% load static %}
<div class="border border-1 rounded px-3 pt-3 mb-3 bg-light-hover">
  <div class="row">
    {% if current_page != "paper" %}
    <div class="col me-2" style="max-width:10px">{{ index }}.</div>
    {% endif %}
    <div class="col">
      {% if current_page != "paper" %}
      <div><a class="fs-6 text-primary" href="{% url "group:paper" id=paper.pk group_name=group.name %}">{{ paper.title }}</a></div>
      {% else %}
      <div class="fs-6 fw-bold my-2">{{ paper.title }}</div>
      {% endif %}
      <div>
        {{ paper.pub_year }},
        <i>{{ paper.journal }}</i>.
        {% if paper.doi %}DOI: <a class="link-success" href="https://doi.org/{{ paper.doi }}" target="_blank">{{ paper.doi }}</a>{% endif %}
        {% if paper.pmid %}PMID: <a class="link-success" href="http://www.ncbi.nlm.nih.gov/pubmed/{{ paper.pmid }}" target="_blank">{{ paper.pmid }}</a>{% endif %}
        {% if paper.pmcid %}PMCID: <a class="link-success" href="http://www.ncbi.nlm.nih.gov/pmc/articles/{{ paper.pmcid }}" target="_blank">{{ paper.pmcid }}</a>{% endif %}
        {% if paper.arxiv_id %}arXiv ID: <a class="link-success" href="https://arxiv.org/abs/{{ paper.arxiv_id }}" target="_blank">{{ paper.arxiv_id }}</a>{% endif %}
        {% if paper.cnki_id %}CNKI ID: <a class="link-success" href="https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CJFD&filename={{ paper.cnki_id }}" target="_blank">{{ paper.cnki_id|escape }}</a>{% endif %}
      </div>
      <div>
        {% if paper.is_preprint %}<span class="badge rounded-pill text-bg-secondary">Preprint</span>{% endif %}
        {% if paper.is_review %}<span class="badge rounded-pill text-bg-secondary">Review</span>{% endif %}
        {% if paper.is_open %}<span class="badge rounded-pill text-bg-secondary">Open</span>{% endif %}
      </div>

      {% if current_page == "paper" %}
        <div class="mt-3">
          <span class="fw-bold">Authors:</span>
          {{ paper.authors|show_author_list }}
        </div>

        <div class="mt-3">
          <span class="fw-bold">Abstract:</span>
          <div>
            {% if paper.abstract %}
              {% autoescape off %}
                {{ paper.abstract|replace_line_br }}
              {% endautoescape %}
            {% else %}
            <i>No abstract available.</i>
            {% endif %}
          </div>
        </div>

        {% if paper.keywords %}
        <div class="mt-3">
          <b>Keywords:</b>
          {{ paper.keywords }}
        </div>
        {% endif %}

        {% if paper.urls %}
        <div class="mt-3">
          <div class="url-label"><b>Related Links:</b></div>
          <div class="url-item"><ul>
            {% with paper.urls|splitlines as urls %}
            {% for u in urls %}
            <li><a class="link-success" href="{{ u }}" target="_blank">{{ u }}</a></li>
            {% endfor %}
            {% endwith %}
          </ul></div>
        </div>
        {% endif %}
      {% endif %}
      
      <div class="border border-1 mt-3 p-1">
        <div class="float-end fst-italic">{{ paper.create_time|date:'Y-m-d H:i:s' }}</div>
        <div class="mb-3"><a class="link-dark" href="{% url "group:user" id=paper.creator.pk group_name=group.name %}">{{ paper.creator }}</a>:</div>
        <div>{% autoescape off %}{{ paper.comments }}{% endautoescape %}</div>
      </div>
    </div>
  </div>
  <div class="text-end my-3">
    {% if user.is_authenticated %}
      {% if current_page == 'trash' %}
        <span class="ms-1">
          <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="#">Restore</a>
        </span>
        <span class="ms-1">
          <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="{% url "group:delete_forever" id=paper.pk group_name=group.name %}" onclick="javascript:return(confirm('Sure to delete paper #' + {{ paper.pk }} + ' forever?'));">[Delete Forever]</a>
        </span>
      {% else %}
        <span class="ms-1">
          <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="#" data-bs-toggle="modal" data-bs-target="#editModal" data-paper-id="{{ paper.doi }}">Edit</a>
        </span>
        <span class="ms-1">
          <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="#" data-bs-toggle="modal" data-bs-target="#deleteModal" data-paper-id="{{ paper.doi }}">Delete</a>
        </span>
      {% endif %}
    {% endif %}
  </div>
</div>
