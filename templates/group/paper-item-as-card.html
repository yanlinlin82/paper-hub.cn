{% load view_extras %}{% load static %}
<div class="border border-1 rounded px-3 py-3 mb-3 bg-light">
  <div class="paper-op-list">
    <div class="paper-op-list-sub-left">
      <a class="link-dark" href="{% url "group:paper" id=paper.pk group_name=group.name %}">[{{ paper.pk }}]</a>
      {% if user.is_authenticated %}
      <div id="favor_{{ paper.pk }}" class="{% if paper.is_favorite %}starred{% else %}unstarred{% endif %}" onclick="javascript:toggle_favor({{ paper.pk }});">
      </div>
      <script>
      function toggle_favor(id) {
        e = document.getElementById('favor_' + id)
        if (e.className == "starred") {
          e.className = "unstarred";
        } else {
          e.className = "starred";
        }
      }
      </script>
      {% endif %}
    </div>
    <div class="paper-op-list-sub-right">
      {% if user.is_authenticated %}
{% if current_page == 'trash' %}
      <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="{% url "group:restore_from_trash" id=paper.pk group_name=group.name %}">[Restore]</a>
      <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="{% url "group:delete_forever" id=paper.pk group_name=group.name %}" onclick="javascript:return(confirm('Sure to delete paper #' + {{ paper.pk }} + ' forever?'));">[Delete Forever]</a>
{% else %}
      <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="{% url "group:edit" id=paper.pk group_name=group.name %}">[Edit]</a>
      <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="{% url "group:delete" id=paper.pk group_name=group.name %}" onclick="javascript:return(confirm('Sure to remove paper #' + {{ paper.pk }} + '?'));">[Delete]</a>
{% endif %}
      {% comment %}
      <a class="link-success link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover" href="javascript: share({{ paper.pk }})">[分享]</a>
      {% endcomment %}
      {% endif %}
    </div>
  </div>
  <div class="paper-info">
    {{ paper.pub_year }},
    <i>{{ paper.journal }}</i>.
    {% if paper.doi %}DOI: <a class="link-success" href="https://doi.org/{{ paper.doi }}" target="_blank">{{ paper.doi }}</a>{% endif %}
    {% if paper.pmid %}PMID: <a class="link-success" href="http://www.ncbi.nlm.nih.gov/pubmed/{{ paper.pmid }}" target="_blank">{{ paper.pmid }}</a>{% endif %}
    {% if paper.pmcid %}PMCID: <a class="link-success" href="http://www.ncbi.nlm.nih.gov/pmc/articles/{{ paper.pmcid }}" target="_blank">{{ paper.pmcid }}</a>{% endif %}
    {% if paper.arxiv_id %}arXiv ID: <a class="link-success" href="https://arxiv.org/abs/{{ paper.arxiv_id }}" target="_blank">{{ paper.arxiv_id }}</a>{% endif %}
    {% if paper.cnki_id %}CNKI ID: <a class="link-success" href="https://kns.cnki.net/kcms/detail/detail.aspx?dbcode=CJFD&filename={{ paper.cnki_id }}" target="_blank">{{ paper.cnki_id|escape }}</a>{% endif %}
    <div class="paper-title"><b>{{ paper.title }}</b></div>
    <div style="padding: 0 0 10px 0;">
      {% if user.is_authenticated %}
      {% if paper.is_favorite %}<span class="badge rounded-pill text-bg-secondary">Favorite</span>{% endif %}
      {% endif %}
      {% if paper.is_preprint %}<span class="badge rounded-pill text-bg-secondary">Preprint</span>{% endif %}
      {% if paper.is_review %}<span class="badge rounded-pill text-bg-secondary">Review</span>{% endif %}
      {% if paper.is_open %}<span class="badge rounded-pill text-bg-secondary">Open</span>{% endif %}
    </div>
    <div style="font-size: 14px; float: right; margin-top: -1.5em;"><a id="paper_button_{{ paper.pk }}" href="javascript:toggle({{paper.pk}});">{% if current_page == "paper" %}[Less]{% else %}[More]{% endif %}</a></div>
    <script>
      function toggle(id) {
        e = document.getElementById('paper_detail_' + id);
        b = document.getElementById('paper_button_' + id);
        if (e.style.display == 'none') {
          e.style.display = 'block';
          b.innerText = '[Less]';
        } else {
          e.style.display = 'none';
          b.innerText = '[More]';
        }
      }
    </script>
  </div>
  <div class="paper-details" id="paper_detail_{{ paper.pk }}"{% if current_page != "paper" %} style="display: none;"{% endif %}>
    <div class="paper-authors">
      <b>Authors:</b>
      {{ paper.authors|show_author_list }}
    </div>
    <div class="paper-abstract">
      <div class="abstract-label"><b>Abstract:</b></div>
      <div>{% if paper.abstract %}{% autoescape off %}{{ paper.abstract|replace_line_br }}{% endautoescape %}{% else %}<i>No abstract available.</i>{% endif %}</div>
    </div>
    {% if paper.keywords %}
    <div class="paper-keywords">
      <b>Keywords:</b>
      {{ paper.keywords }}
    </div>
    {% endif %}
    {% if paper.urls %}
    <div class="paper-urls">
      <div class="url-label"><b>Related Links:</b></div>
      <div class="url-item"><ul>
        {% with paper.urls|splitlines as urls %}
        {% for u in urls %}
        <li><a class="link-success" href="{{ u }}" target="_blank">{{ u }}</a></li>
        {% endfor %}
        {% endwith %}
      </ul></div>
    </div>
    {% endif %}
  </div>
  <div class="paper-comments-block">
    <hr class="paper-sep-line">
    <div class="paper-comments-head mb-3">
      [{{ paper.create_time|date:'Y-m-d H:i:s' }}]
      <a class="link-dark fw-bold" href="{% url "group:user" id=paper.creator.pk group_name=group.name %}">{{ paper.creator }}</a>:
      {% if group.name != "xiangma" %}
        {% if paper.create_time|date:'Y-m-d H:i:s' < paper.update_time|date:'Y-m-d H:i:s' %}
        <span class="fst-italic">(updated at {{ paper.update_time|date:'Y-m-d H:i:s' }})</span>
        {% endif %}
      {% endif %}
    </div>
    <div class="paper-comments">{% autoescape off %}{{ paper.comments }}{% endautoescape %}</div>
  </div>
</div>
